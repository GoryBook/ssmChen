<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oaec.ssm.biz.sys.dao.UserDao">
    <!--parameterType是指输入查询内容，如果查询的是数据类型直接写即可，如果是定义类型则必须写全包名-->
    <!--resultType是指返回的，如果返回的是数据类型可不写，如果是定义类型则必须写全包名-->



    <!--实现添加按钮-->
    <insert id="addUser" parameterType="map">
        insert into user(userName,realName,valid,password)
        values(#{userName},#{realName},#{valid},#{password})
    </insert>
    <update id="updateUser" parameterType="map">
        update user set userName=#{userName},realName=#{realName},
        valid=#{valid},password=#{password} where id = #{id}
    </update>


    <!--下面两个语句是实现查询表内容并分页显示-->
    <select id="queryUserList" parameterType="map" resultType="map">
        select * from user where 1 =1
        <if test="userName!=null and userName!=''">
            and userName like CONCAT(CONCAT('%',#{userName}),'%')
        </if>
        <if test="realName!=null and realName!=''">
            and realName like CONCAT(CONCAT('%',#{realName}),'%')
        </if>
        <if test="valid!=null and valid!=''">
            and valid = #{valid}
        </if>
        order by id
        limit #{start} , #{rows}
    </select>

    <select id="queryUserCount" parameterType="map" resultType="int">
        select count(id) from user where 1 =1
        <if test="roleName!=null and roleName!=''">
            and roleName like CONCAT(CONCAT('%',#{roleName}),'%')
        </if>
        <if test="roleCode!=null and roleCode!=''">
            and realName like CONCAT(CONCAT('%',#{realName}),'%')
        </if>
        <if test="valid!=null and valid!=''">
            and valid = #{valid}
        </if>
    </select>

    <select id="queryValidRole" resultType="map">
        select * from role where valid = '1'
    </select>

    <select id="queryOldRole" parameterType="int" resultType="int">
        select roleId from user_role where userId = #{userId}
    </select>

   <!-- 授予角色，先删除记录再添加选中的-->
    <delete id="deleteOldRole" parameterType="int">
        delete from user_role where userId = #{userId}
    </delete>

    <insert id="addNewRoleOfUser" parameterType="list">
        <if test="list!=null and list.size>0">
            insert into user_role(userId,roleId) values
            <foreach collection="list" item="row" open=" " close=" " separator=",">
                (#{row.userId},#{row.roleId})
            </foreach>
        </if>
    </insert>


    <select id="selectUser" parameterType="string" resultType="map">
        select * from user where userName = #{userName}
    </select>
</mapper>

